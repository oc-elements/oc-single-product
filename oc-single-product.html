<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../oc-product-api/oc-product-api.html">
<link rel="import" href="../oc-toast/oc-toast.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-input/iron-input.html">
<dom-module id="oc-single-product">
  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>

      :host {
        display: block;
		    background: #f8f8f8;
        font-family: var(--paper-font-common-base_-_font-family);
		    --paper-input-container-input-color: black;

        --paper-input-container:{
        position: absolute;
        top:-20px;
        right:20px;
        width:50px !important;
        };

		--paper-input: {
			width:20px;
		};
		paper-input: {
			width:20px;
		}
      }

      .category-heading {
        border-top: 1px #cecece solid;
        border-bottom: 1px #cecece solid;
        background: #f8f8f8;
        color: #000;
		    margin: -1px -15px 0 -15px;
      }
      .clear-heading {
        background: #fff;
        padding: 12px 0;
        margin-top:-1px;
      }
	  .product-description p {
		  color:#33404d;
		  padding:10px 0 20px 0;
	  }
      h3 {
        font-size:1.23em !important;
		    font-weight:800 !important;
        margin: 10px 0 !important;
      }

      .add-button-row {
        background: #ffffff;
        margin: 15px 0;
      }
      .add-button {
        width: 100%;
        color: #fff;
        background: #2BB673;
      }

      .close-button {
        width: 100%;
        color: #fff;
        background: lightgray;
      }

      .large-price {
		    color: #2BB673;
        font-size:1.45em;
		    font-weight: 800 !important;
        position:absolute;
      }

	  .inline-input {
		  color: red;
	  }

      paper-button.bordered {
        border: 1px solid #000;
      }

      .images img{
        display: block;
        margin:auto;
        max-height:120px;
      }

      .horizontal {
        @apply(--layout-horizontal);
      }

    </style>
    <div class="container-fluid">
      <div class="row category-heading">
        <div class="col-xs-5">
          <div class="images center">
            <img src="[[product.images.0.name]]" alt="product image" class="pull-left">
          </div>
		</div>
		<div class="col-xs-7 heading-section">
				<h3>[[product.name]]</h3>
					<span>[[product.shortDescription]]</span>
				<template is="dom-if" is="[[item.discount">
						<span>R[[product.discount.originalPrice]]</del></small></span>
					  </template>
				<div><span class="large-price" id="product-price">R [[product.price]]</span></div>

		</div>
      </div>
      <div class="row category-heading">

        <div class="col-xs-4">

        </div>
      </div>
      <div class="row category-heading">
		<div class="col-xs-6">
			<div>[[product.name]]</div>
			<div>@ R[[product.price]]</div>
		</div>
        <div class="col-xs-6">
			<div class="horizontal">
				<span style="margin-top:10px">Qty</span> <iron-input><input class="pull-right" id="" value="{{product.initQuantity}}" type="number" placeholder="1" allowed-pattern="[0-9]"style="width: 60px;
					margin-left: 10px;
					margin-top: 10px;
					padding: 0px 5px;
					border: 1px solid #000;
					border-radius: 5px;"></input></iron-input>
				<span style="margin: 10px 0 0 10px;
					background: orange;
					color: #fff;
					font-size: 19px;
					border-radius: 50%;
					padding: 0px 8px;
					width: 26px;
					height: 26px;" on-tap="_addToCart">+</span>
			</div>
			<!-- <div class="quantity-box pull-right"><h4>{{product.initQuantity}}</h4></div> -->
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 product-description">
          <p>[[product.description]]</p>
        </div>
      </div>
    </div>
  </template>

  <script>
      class OcSingleProduct extends Polymer.Element {
          static get is() { return 'oc-single-product'; }
          static get properties() { return {
              product: {
                  type: Number,
                  value: {}
			  },
			  _product: {
					type: Object,
					value: {}
					},

              cartData: {
                  type: Object,
                  value: {}
			  },
			  	productObject: {
					type:Object
				},
              _cartDataQuantity: {
                  type: Number,
                  value: 1,
                  notify: true
              }

          };
          }

          ready() {
              super.ready();
          }
          /**
           * Close the product to show the list of products. Listens in shop-product-list
           */
          _closeSingleProduct () {
              this.dispatchEvent(new CustomEvent('close-single-product', {
                  bubbles: true, composed: true
              }));
          }

          // Check if next item's seller matches with the sellers in current cart
          _isValidToAddNewItems() {
              if(this.cartData.items) {
                  for (let i = 0; i < this.cartData.items.length; i++) {
                      if (this.cartData.items[i].detail.organisation.id === this.product.organisation.id) continue;

                      this.$.toast.failed("You may only have one seller's items in basket \n" +
                          "First checkout or remove the other seller's items from cart.");
                      return false
                  }
              }
              return true
          }

          /**
           * Add item to cart
           */
          _addToCart(event) {
              // Don't add item to cart if false
              if (!this._isValidToAddNewItems()) return;
			  this.productObject = {
						item: this.product,
						quantity: this.product.initQuantity
					}
              this.dispatchEvent(new CustomEvent('add-to-cart', {
				bubbles: true, composed: true, detail: this.productObject
              }));
          }
      }

      window.customElements.define(OcSingleProduct.is, OcSingleProduct);
  </script>
</dom-module>
